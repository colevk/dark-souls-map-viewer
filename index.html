<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dark Souls Map Viewer</title>
  <link href="css/reset.css" rel="stylesheet" type="text/css">

  <script src="js/lib/jquery-2.1.1.min.js"></script>
  <script src="js/lib/three.js"></script>

  <script src="js/BigShader.js"></script>
  <script src="js/Interface.js"></script>
  <script src="js/Controls.js"></script>
  <script src="js/SceneLoader.js"></script>
  <script src="js/Config.js"></script>
</head>

<body style="overflow:hidden;">
  <div id="sidebar" style="height: 100vh; width: 25rem; float: right; overflow: auto">
    <label><input id="normalShading" type="checkbox" onchange="Interface.toggleNormalShading()">Show normals</label><br>
    <label><input id="edgeHighlight" type="checkbox" onchange="Interface.toggleEdgeHighlighting()">Highlight edges</label><br>
    <label><input id="backfaceCulling" type="checkbox" onchange="Interface.toggleBackfaceCulling()">Cull backfaces</label><br>
    <label><input id="wrapAround" type="checkbox" onchange="Interface.toggleWrapAround()">Wrap-around lighting</label><br>
    <input type="color" value="#000000" onchange="Interface.setEdgeColor(this.value)">Edge color<br>
    <input type="color" value="#ffffff" onchange="Interface.setLightColor(this.value)">Light color<br>
    <button onclick="Interface.resetCamera()">Reset camera position</button><br>
    <select onchange="Interface.swapGames()">
      <option value="ds1">Dark Souls 1</option>
      <option value="ds2">Dark Souls 2</option>
    </select>
    <form id="ds1"></form>
    <form id="ds2"></form>
  </div>
  <div id="canvas" style="height: 100vh; margin-right: 25rem;"></div>

  <script>
  var sidebar, canvas, renderer, clock, scene, camera, controls, material,
      meshes, currentGame;

  function init() {
    sidebar = $('#sidebar');
    canvas = $('#canvas');

    renderer = new THREE.WebGLRenderer();
    renderer.setSize( canvas.width(), canvas.height() );
    canvas.append(renderer.domElement);

    clock = new THREE.Clock();
    scene = new THREE.Scene();
    material = BigShaderMaterial;

    camera = new THREE.PerspectiveCamera( 75, canvas.width() / canvas.height(), 0.1, 10000 );

    controls = new Controls(camera, renderer.domElement);

    camera.position = Config.defaultCameraPosition();
    camera.lookAt(Config.defaultCameraLookAt());

    meshes = [];
    currentGame = 'ds1';

    for (var i = 0; i < Config.ds1.length; i++) {
      function loadFunc(bufferGeometry, fileNumber) {
        var mesh = new THREE.Mesh(bufferGeometry, BigShaderMaterial);
        mesh.game = 'ds1';
        mesh.fileNumber = fileNumber;
        meshes.push(mesh);

        if (Config.ds1State[fileNumber]) { scene.add(mesh); }
      };

      SceneLoader.loadIVFile('data/ds1/' + Config.ds1[i] + '.iv', i, loadFunc);
    }

    for (var i = 0; i < Config.ds2.length; i++) {
      var loadFunc = function (bufferGeometry, fileNumber) {
        var mesh = new THREE.Mesh(bufferGeometry, BigShaderMaterial);
        mesh.game = 'ds2';
        mesh.fileNumber = fileNumber;
        meshes.push(mesh);
      };

      SceneLoader.loadIVFile('data/ds2/' + Config.ds2[i] + '.iv', i, loadFunc);
    }

    scene.add(Config.light);
  }

  var render = function() {
    requestAnimationFrame(render);

    controls.update(clock.getDelta());
    renderer.render(scene, camera);
  };

  init();
  Interface.setupInterface();
  render();
  </script>
</body>
</html>
